<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>Consulta API Dicionário Aberto</title>

    </head>
    
    <body>

        <div>
            <h1>Consulta API Dicionário Aberto</h1>
            <input type="text" id="inputPalavra" placeholder="Digite aqui uma palavra">
            <button onClick="handleOnClick()">Consultar</button>
            <button onClick="handleLimparOnClick()">Limpar</button>
            <div style="margin-top:15px"id="loadingDiv"></div>
            <p id="nearResp"></p>
            <p id="wordResp"></p>
        </div>

        <script>

            //
            function handleOnClick() {
                document.getElementById('loadingDiv').innerHTML = '<img id="loadingImg" style="width:30px" src="https://i.gifer.com/ZKZg.gif">';
                const palavra = document.getElementById("inputPalavra").value;
                
                clearResponses();

                consultaNear(palavra);
                consultaWord(palavra);
            }
            
            function consultaWord(palavra) {
                fetch(`https://api.dicionario-aberto.net/word/${palavra}`, {
                    method : "GET",
                })
                .then( (resp) => resp.json() )
                .then( (data) => {
                    parseWordResponse(data);             
                })
                .catch ( (err) => console.log(err));
            }

            function parseWordResponse(data) {
                document.getElementById('loadingDiv').innerHTML = '';
                var conteudo = '<strong>Definição:</strong><br>';
                    data.map ( (def) => {
                        conteudo += def.xml + '<br><br>';
                    })
                    document.getElementById("wordResp").innerHTML = conteudo;
            }

            function consultaNear(palavra) {
                fetch(`https://api.dicionario-aberto.net/near/${palavra}`, {
                    method : "GET",
                })
                .then( (resp) => resp.json() )
                .then( (data) => {
                    parseNearResponse(data);
                })
                .catch ( (err) => console.log(err));
            }

            function parseNearResponse(data) {
                document.getElementById('loadingDiv').innerHTML = '';
                
                var conteudo = '<strong>Palavras próximas:</strong> ';
                data.map( (palavra) => {
                    conteudo += palavra + ", ";
                })
                document.getElementById("nearResp").innerHTML = conteudo;
            }

            function handleLimparOnClick() {
                clearInput();
                clearResponses();
            }

            function clearInput() {
                document.getElementById("inputPalavra").value = '';
            }

            function clearResponses() {
                document.getElementById("nearResp").innerHTML = ''
                document.getElementById("wordResp").innerHTML = ''
            }
        </script>

    </body> 
</html>